(* Content-type: application/vnd.wolfram.mathematica *)

(*** Wolfram Notebook File ***)
(* http://www.wolfram.com/nb *)

(* CreatedBy='Mathematica 11.3' *)

(*CacheID: 234*)
(* Internal cache information:
NotebookFileLineBreakTest
NotebookFileLineBreakTest
NotebookDataPosition[       158,          7]
NotebookDataLength[     40574,        956]
NotebookOptionsPosition[     39687,        935]
NotebookOutlinePosition[     40020,        950]
CellTagsIndexPosition[     39977,        947]
WindowFrame->Normal*)

(* Beginning of Notebook Content *)
Notebook[{
Cell[BoxData[{
 RowBox[{"ClearAll", "[", "\"\<Global`*\>\"", "]"}], "\[IndentingNewLine]", 
 RowBox[{"ClearSystemCache", "[", "]"}], "\[IndentingNewLine]", 
 RowBox[{
  RowBox[{"$PrePrint", "=", "MatrixForm"}], ";"}]}], "Input",
 CellLabel->"In[25]:=",ExpressionUUID->"d9d3ee98-09f5-400c-b165-482fd4ca14fc"],

Cell[BoxData[
 RowBox[{
  RowBox[{"SetDirectory", "[", 
   RowBox[{
    RowBox[{"ToString", "[", 
     RowBox[{"NotebookDirectory", "[", "]"}], "]"}], "<>", 
    "\"\</BasisData\>\""}], "]"}], ";"}]], "Input",
 CellChangeTimes->{{3.787664381360734*^9, 3.7876643816314917`*^9}, {
   3.787664450462509*^9, 3.787664452636215*^9}, 3.787664701268478*^9},
 CellLabel->"In[28]:=",ExpressionUUID->"6146baa7-61d9-49d3-a1d3-1372aa59537b"],

Cell[BoxData[{
 RowBox[{
  RowBox[{"nA", "=", "1"}], ";"}], "\[IndentingNewLine]", 
 RowBox[{
  RowBox[{"nB", "=", "1"}], ";"}], "\[IndentingNewLine]", 
 RowBox[{
  RowBox[{"emax", "=", "50"}], ";"}], "\[IndentingNewLine]", 
 RowBox[{
  RowBox[{"stride", "=", 
   RowBox[{"nA", "+", "nB"}]}], ";"}]}], "Input",
 CellChangeTimes->{{3.787664942721113*^9, 3.7876649453930683`*^9}, {
  3.787664987237303*^9, 3.787664987650045*^9}, {3.787666397937845*^9, 
  3.787666405557433*^9}, {3.7876668015309362`*^9, 3.787666802722486*^9}, {
  3.787667861508498*^9, 3.787667861966524*^9}, {3.787668655863338*^9, 
  3.787668656710121*^9}},
 CellLabel->"In[16]:=",ExpressionUUID->"885eaba1-f8e9-4062-b490-18e6f5ebbe3b"],

Cell[BoxData[{
 RowBox[{
  RowBox[{"name", "=", 
   RowBox[{"\"\<R_nA=\>\"", "<>", 
    RowBox[{"ToString", "[", "nA", "]"}], "<>", "\"\<_nB=\>\"", "<>", 
    RowBox[{"ToString", "[", "nB", "]"}], "<>", "\"\<_Emax=\>\"", "<>", 
    RowBox[{"ToString", "[", "emax", "]"}]}]}], 
  ";"}], "\[IndentingNewLine]", 
 RowBox[{
  RowBox[{"ranges", "=", 
   RowBox[{"Import", "[", 
    RowBox[{
     RowBox[{"name", "<>", "\"\<.basisrange\>\""}], ",", "\"\<Table\>\""}], 
    "]"}]}], ";"}], "\[IndentingNewLine]", 
 RowBox[{
  RowBox[{
   RowBox[{"ranges", "=", 
    RowBox[{"Table", "[", 
     RowBox[{
      RowBox[{"ranges", "[", 
       RowBox[{"[", 
        RowBox[{"i", ",", "1"}], "]"}], "]"}], ",", 
      RowBox[{"{", 
       RowBox[{"i", ",", 
        RowBox[{"Length", "[", "ranges", "]"}]}], "}"}]}], "]"}]}], ";"}], 
  "\[IndentingNewLine]"}], "\[IndentingNewLine]", 
 RowBox[{
  RowBox[{"basis", "=", 
   RowBox[{"Import", "[", 
    RowBox[{
     RowBox[{"name", "<>", "\"\<.basis\>\""}], ",", "\"\<Table\>\""}], 
    "]"}]}], ";"}], "\[IndentingNewLine]", 
 RowBox[{
  RowBox[{"output", "=", 
   RowBox[{"name", "<>", "\"\<.integrals\>\""}]}], 
  ";"}], "\[IndentingNewLine]", 
 RowBox[{
  RowBox[{"outputRanges", "=", 
   RowBox[{"name", "<>", "\"\<.integralsrange\>\""}]}], 
  ";"}], "\[IndentingNewLine]"}], "Input",
 CellChangeTimes->{{3.78766471239822*^9, 3.787664875047256*^9}, {
  3.787664931032651*^9, 3.7876649334579353`*^9}, {3.787677452490115*^9, 
  3.787677452865836*^9}},ExpressionUUID->"785c69a0-1d95-452d-b968-\
dd6c4839635b"],

Cell[CellGroupData[{

Cell[BoxData[{
 RowBox[{
  RowBox[{"SymmetricDifference", "[", 
   RowBox[{"a_", ",", "b_"}], "]"}], ":=", 
  RowBox[{"Union", "[", 
   RowBox[{
    RowBox[{"Complement", "[", 
     RowBox[{"a", ",", "b"}], "]"}], ",", 
    RowBox[{"Complement", "[", 
     RowBox[{"b", ",", "a"}], "]"}]}], "]"}]}], "\[IndentingNewLine]", 
 RowBox[{
  RowBox[{"integrationRange", "=", "15"}], ";"}], "\[IndentingNewLine]", 
 RowBox[{
  RowBox[{
   RowBox[{"V", "[", 
    RowBox[{"x_", ",", "y_"}], "]"}], ":=", 
   RowBox[{"DiracDelta", "[", "x", "]"}]}], ";"}], "\[IndentingNewLine]", 
 RowBox[{
  RowBox[{"Int", "[", "q_", "]"}], ":=", 
  RowBox[{"Integrate", "[", 
   RowBox[{
    RowBox[{
     RowBox[{"V", "[", "x", "]"}], 
     RowBox[{"Exp", "[", 
      RowBox[{"I", "*", "2", "Pi", "*", "q", "*", "x"}], "]"}]}], ",", " ", 
    RowBox[{"{", 
     RowBox[{"x", ",", 
      RowBox[{"-", "0.5"}], ",", "0.5"}], "}"}]}], 
   "]"}]}], "\[IndentingNewLine]", 
 RowBox[{
  RowBox[{"Ints", "=", 
   RowBox[{"Table", "[", 
    RowBox[{
     RowBox[{"Int", "[", "q", "]"}], ",", 
     RowBox[{"{", 
      RowBox[{"q", ",", 
       RowBox[{
        RowBox[{"-", "2"}], "*", "emax"}], ",", 
       RowBox[{"2", "*", "emax"}]}], "}"}]}], "]"}]}], 
  ";"}], "\[IndentingNewLine]", 
 RowBox[{
  RowBox[{
   RowBox[{"Convert", "[", "n_", "]"}], ":=", 
   RowBox[{"If", "[", 
    RowBox[{
     RowBox[{
      RowBox[{"Mod", "[", 
       RowBox[{"n", ",", "2"}], "]"}], "\[Equal]", "0"}], ",", 
     RowBox[{"Return", "[", 
      RowBox[{"n", "/", "2"}], "]"}], ",", 
     RowBox[{"Return", "[", 
      RowBox[{
       RowBox[{"-", 
        RowBox[{"(", 
         RowBox[{"n", "+", "1"}], ")"}]}], "/", "2"}], "]"}]}], "]"}]}], 
  ";"}]}], "Input",
 CellChangeTimes->{{3.787661642936658*^9, 3.787661740037712*^9}, {
  3.7876620551715193`*^9, 3.787662075912819*^9}, {3.787662135435157*^9, 
  3.787662143978816*^9}, {3.787662306967236*^9, 3.787662326399178*^9}, {
  3.787664922815152*^9, 3.787664923011298*^9}, {3.787677168783565*^9, 
  3.787677296488565*^9}, {3.787677346957674*^9, 3.787677387042748*^9}, {
  3.787677422389855*^9, 3.78767744122189*^9}, {3.787677766257579*^9, 
  3.787677809559834*^9}, {3.787677875585546*^9, 3.78767792741693*^9}, {
  3.787678025841807*^9, 
  3.787678094028222*^9}},ExpressionUUID->"7da341fc-666e-4921-b72c-\
34e37e1a94e7"],

Cell[BoxData[
 TemplateBox[{
  "Table","iterb",
   "\"Iterator \\!\\(\\*RowBox[{\\\"{\\\", RowBox[{\\\"q\\\", \\\",\\\", \
RowBox[{RowBox[{\\\"-\\\", \\\"2\\\"}], \\\" \\\", \\\"emax\\\"}], \\\",\\\", \
RowBox[{\\\"2\\\", \\\" \\\", \\\"emax\\\"}]}], \\\"}\\\"}]\\) does not have \
appropriate bounds.\"",2,15,3,32705855064187762555,"Local"},
  "MessageTemplate"]], "Message", "MSG",
 CellChangeTimes->{3.787668662092317*^9, 3.787677267381559*^9, 
  3.787677298076885*^9, 3.7876774427273483`*^9},
 CellLabel->
  "During evaluation of \
In[11]:=",ExpressionUUID->"9de52472-d32b-46b9-893a-5b6baf0e74d4"]
}, Open  ]],

Cell[BoxData[{
 RowBox[{
  RowBox[{"OpenWrite", "[", "output", "]"}], ";"}], "\[IndentingNewLine]", 
 RowBox[{
  RowBox[{"OpenWrite", "[", "outputRanges", "]"}], 
  ";"}], "\[IndentingNewLine]", 
 RowBox[{
  RowBox[{
   RowBox[{"mElementCount", "=", "0"}], ";"}], 
  "\[IndentingNewLine]"}], "\[IndentingNewLine]", 
 RowBox[{
  RowBox[{
   RowBox[{"For", "[", 
    RowBox[{
     RowBox[{"r", "=", "1"}], ",", 
     RowBox[{"r", "\[LessEqual]", 
      RowBox[{"Length", "[", "ranges", "]"}]}], ",", 
     RowBox[{"r", "++"}], ",", "\[IndentingNewLine]", 
     RowBox[{
      RowBox[{"For", "[", 
       RowBox[{
        RowBox[{"i", " ", "=", 
         RowBox[{"If", "[", 
          RowBox[{
           RowBox[{"r", "\[Equal]", "1"}], ",", "1", ",", 
           RowBox[{
            RowBox[{"ranges", "[", 
             RowBox[{"[", 
              RowBox[{"r", "-", "1"}], "]"}], "]"}], "+", "1"}]}], "]"}]}], 
        ",", 
        RowBox[{"i", "<=", 
         RowBox[{"ranges", "[", 
          RowBox[{"[", "r", "]"}], "]"}]}], ",", 
        RowBox[{"i", "++"}], ",", "\[IndentingNewLine]", 
        RowBox[{"For", "[", 
         RowBox[{
          RowBox[{"j", "=", "1"}], ",", 
          RowBox[{"j", "\[LessEqual]", "i"}], ",", 
          RowBox[{"j", "++"}], ",", "\[IndentingNewLine]", 
          RowBox[{
           RowBox[{"a1", "=", 
            RowBox[{
             RowBox[{"basis", "[", 
              RowBox[{"[", "i", "]"}], "]"}], "[", 
             RowBox[{"[", 
              RowBox[{"1", ";;", "nA"}], "]"}], "]"}]}], ";", 
           "\[IndentingNewLine]", 
           RowBox[{"b1", "=", 
            RowBox[{
             RowBox[{"basis", "[", 
              RowBox[{"[", "i", "]"}], "]"}], "[", 
             RowBox[{"[", 
              RowBox[{
               RowBox[{"nA", "+", "1"}], ";;", "stride"}], "]"}], "]"}]}], 
           ";", "\[IndentingNewLine]", 
           RowBox[{"a2", "=", 
            RowBox[{
             RowBox[{"basis", "[", 
              RowBox[{"[", "j", "]"}], "]"}], "[", 
             RowBox[{"[", 
              RowBox[{"1", ";;", "nA"}], "]"}], "]"}]}], ";", 
           "\[IndentingNewLine]", 
           RowBox[{"b2", "=", 
            RowBox[{
             RowBox[{"basis", "[", 
              RowBox[{"[", "j", "]"}], "]"}], "[", 
             RowBox[{"[", 
              RowBox[{
               RowBox[{"nA", "+", "1"}], ";;", "stride"}], "]"}], "]"}]}], 
           ";", "\[IndentingNewLine]", 
           RowBox[{"SDa", "=", 
            RowBox[{"SymmetricDifference", "[", 
             RowBox[{"a1", ",", "a2"}], "]"}]}], ";", "\[IndentingNewLine]", 
           RowBox[{"SDb", "=", 
            RowBox[{"SymmetricDifference", "[", 
             RowBox[{"b1", ",", "b2"}], "]"}]}], ";", "\[IndentingNewLine]", 
           "\[IndentingNewLine]", 
           RowBox[{"If", "[", 
            RowBox[{
             RowBox[{
              RowBox[{
               RowBox[{"Length", "[", "SDa", "]"}], ">", "2"}], " ", "||", 
              " ", 
              RowBox[{
               RowBox[{"Length", "[", "SDb", "]"}], ">", "2"}]}], ",", 
             RowBox[{"Continue", "[", "]"}]}], "]"}], ";", 
           "\[IndentingNewLine]", "\[IndentingNewLine]", 
           RowBox[{"If", "[", 
            RowBox[{
             RowBox[{
              RowBox[{
               RowBox[{"Length", "[", "SDa", "]"}], "\[Equal]", "2"}], "&&", 
              RowBox[{
               RowBox[{"Length", "[", "SDb", "]"}], "\[Equal]", "2"}]}], ",", 
             "\[IndentingNewLine]", 
             RowBox[{
              RowBox[{"k1", "=", 
               RowBox[{
                RowBox[{"Complement", "[", 
                 RowBox[{"a1", ",", "a2"}], "]"}], "[", 
                RowBox[{"[", "1", "]"}], "]"}]}], ";", "\[IndentingNewLine]", 
              
              RowBox[{"k2", "=", 
               RowBox[{
                RowBox[{"Complement", "[", 
                 RowBox[{"a2", ",", "a1"}], "]"}], "[", 
                RowBox[{"[", "1", "]"}], "]"}]}], ";", "\[IndentingNewLine]", 
              
              RowBox[{"k3", "=", 
               RowBox[{
                RowBox[{"Complement", "[", 
                 RowBox[{"b1", ",", "b2"}], "]"}], "[", 
                RowBox[{"[", "1", "]"}], "]"}]}], ";", "\[IndentingNewLine]", 
              
              RowBox[{"k4", "=", 
               RowBox[{
                RowBox[{"Complement", "[", 
                 RowBox[{"b2", ",", "b1"}], "]"}], "[", 
                RowBox[{"[", "1", "]"}], "]"}]}], ";", "\[IndentingNewLine]", 
              "\[IndentingNewLine]", 
              RowBox[{"If", "[", 
               RowBox[{
                RowBox[{
                 RowBox[{
                  RowBox[{"Convert", "[", "k2", "]"}], "+", 
                  RowBox[{"Convert", "[", "k3", "]"}]}], "\[NotEqual]", 
                 RowBox[{
                  RowBox[{"Convert", "[", "k1", "]"}], "+", 
                  RowBox[{"Convert", "[", "k3", "]"}]}]}], ",", 
                RowBox[{"Continue", "[", "]"}]}], "]"}], ";", 
              "\[IndentingNewLine]", "\[IndentingNewLine]", 
              RowBox[{"k1pos", "=", 
               RowBox[{
                RowBox[{"Position", "[", 
                 RowBox[{"a1", ",", 
                  RowBox[{
                   RowBox[{"Complement", "[", 
                    RowBox[{"a1", ",", "a2"}], "]"}], "[", 
                   RowBox[{"[", "1", "]"}], "]"}]}], "]"}], "[", 
                RowBox[{"[", 
                 RowBox[{"1", ",", "1"}], "]"}], "]"}]}], ";", 
              "\[IndentingNewLine]", 
              RowBox[{"k2pos", "=", 
               RowBox[{
                RowBox[{"Position", "[", 
                 RowBox[{"a2", ",", 
                  RowBox[{
                   RowBox[{"Complement", "[", 
                    RowBox[{"a2", ",", "a1"}], "]"}], "[", 
                   RowBox[{"[", "1", "]"}], "]"}]}], "]"}], "[", 
                RowBox[{"[", 
                 RowBox[{"1", ",", "1"}], "]"}], "]"}]}], ";", 
              "\[IndentingNewLine]", 
              RowBox[{"k3pos", "=", 
               RowBox[{
                RowBox[{"Position", "[", 
                 RowBox[{"b1", ",", 
                  RowBox[{
                   RowBox[{"Complement", "[", 
                    RowBox[{"b1", ",", "b2"}], "]"}], "[", 
                   RowBox[{"[", "1", "]"}], "]"}]}], "]"}], "[", 
                RowBox[{"[", 
                 RowBox[{"1", ",", "1"}], "]"}], "]"}]}], ";", 
              "\[IndentingNewLine]", 
              RowBox[{"k4pos", "=", 
               RowBox[{
                RowBox[{"Position", "[", 
                 RowBox[{"b2", ",", 
                  RowBox[{
                   RowBox[{"Complement", "[", 
                    RowBox[{"b2", ",", "b1"}], "]"}], "[", 
                   RowBox[{"[", "1", "]"}], "]"}]}], "]"}], "[", 
                RowBox[{"[", 
                 RowBox[{"1", ",", "1"}], "]"}], "]"}]}], ";", 
              "\[IndentingNewLine]", "\[IndentingNewLine]", 
              RowBox[{"list", "=", 
               RowBox[{"Sort", "[", 
                RowBox[{"List", "[", 
                 RowBox[{"k1", ",", "k2", ",", "k3", ",", "k4"}], "]"}], 
                "]"}]}], ";", "\[IndentingNewLine]", "\[IndentingNewLine]", 
              RowBox[{"mElement", "=", 
               RowBox[{
                RowBox[{
                 RowBox[{"(", 
                  RowBox[{"-", "1"}], ")"}], "^", 
                 RowBox[{"(", 
                  RowBox[{"k1pos", "+", "k2pos", "+", "k3pos", "+", "k4pos"}],
                   ")"}]}], "*", 
                RowBox[{"Ints", "[", 
                 RowBox[{"[", " ", 
                  RowBox[{
                   RowBox[{"Convert", "[", "k2", "]"}], "-", 
                   RowBox[{"Convert", "[", "k1", "]"}], "+", 
                   RowBox[{"2", "*", "emax"}], "+", "1"}], " ", "]"}], 
                 "]"}]}]}], ";", "\[IndentingNewLine]", "\[IndentingNewLine]", 
              RowBox[{"str", " ", "=", " ", 
               RowBox[{
                RowBox[{"ToString", "[", "i", "]"}], "<>", " ", "\"\< \>\"", "<>", 
                RowBox[{"ToString", "[", "j", "]"}], " ", "<>", " ", 
                "\"\< \>\"", "<>", 
                RowBox[{"ToString", "[", 
                 RowBox[{"NumberForm", "[", 
                  RowBox[{"mElement", ",", "Infinity", ",", 
                   RowBox[{"ExponentFunction", "\[Rule]", 
                    RowBox[{"(", 
                    RowBox[{"Null", "&"}], ")"}]}]}], "]"}], "]"}], "<>", 
                " ", "\"\<\\n\>\""}]}], ";", "\[IndentingNewLine]", 
              RowBox[{"WriteString", "[", 
               RowBox[{"output", ",", "str"}], "]"}], ";", 
              "\[IndentingNewLine]", 
              RowBox[{"mElementCount", "++"}], ";", "\[IndentingNewLine]", 
              "\[IndentingNewLine]", 
              RowBox[{"Continue", "[", "]"}], ";"}]}], "]"}], ";", 
           "\[IndentingNewLine]", "\[IndentingNewLine]", 
           RowBox[{"If", "[", 
            RowBox[{
             RowBox[{
              RowBox[{
               RowBox[{"Length", "[", "SDa", "]"}], "\[Equal]", "2"}], "&&", 
              RowBox[{
               RowBox[{"Length", "[", "SDb", "]"}], "\[Equal]", "0"}]}], ",", 
             "\[IndentingNewLine]", 
             RowBox[{
              RowBox[{"k1", "=", 
               RowBox[{
                RowBox[{"Complement", "[", 
                 RowBox[{"a1", ",", "a2"}], "]"}], "[", 
                RowBox[{"[", "1", "]"}], "]"}]}], ";", "\[IndentingNewLine]", 
              
              RowBox[{"k2", "=", 
               RowBox[{
                RowBox[{"Complement", "[", 
                 RowBox[{"a2", ",", "a1"}], "]"}], "[", 
                RowBox[{"[", "1", "]"}], "]"}]}], ";", "\[IndentingNewLine]", 
              "\[IndentingNewLine]", 
              RowBox[{"If", "[", 
               RowBox[{
                RowBox[{
                 RowBox[{"Mod", "[", 
                  RowBox[{
                   RowBox[{"k1", "+", "k2"}], ",", "2"}], "]"}], "\[Equal]", 
                 "1"}], ",", 
                RowBox[{"Continue", "[", "]"}]}], "]"}], ";", 
              "\[IndentingNewLine]", "\[IndentingNewLine]", 
              RowBox[{"k1pos", "=", 
               RowBox[{
                RowBox[{"Position", "[", 
                 RowBox[{"a1", ",", 
                  RowBox[{
                   RowBox[{"Complement", "[", 
                    RowBox[{"a1", ",", "a2"}], "]"}], "[", 
                   RowBox[{"[", "1", "]"}], "]"}]}], "]"}], "[", 
                RowBox[{"[", 
                 RowBox[{"1", ",", "1"}], "]"}], "]"}]}], ";", 
              "\[IndentingNewLine]", 
              RowBox[{"k2pos", "=", 
               RowBox[{
                RowBox[{"Position", "[", 
                 RowBox[{"a2", ",", 
                  RowBox[{
                   RowBox[{"Complement", "[", 
                    RowBox[{"a2", ",", "a1"}], "]"}], "[", 
                   RowBox[{"[", "1", "]"}], "]"}]}], "]"}], "[", 
                RowBox[{"[", 
                 RowBox[{"1", ",", "1"}], "]"}], "]"}]}], ";", 
              "\[IndentingNewLine]", "\[IndentingNewLine]", 
              RowBox[{"mElement", "=", "0"}], ";", "\[IndentingNewLine]", 
              RowBox[{"For", "[", 
               RowBox[{
                RowBox[{"p", "=", "1"}], ",", 
                RowBox[{"p", "\[LessEqual]", "nB"}], ",", 
                RowBox[{"p", "++"}], ",", "\[IndentingNewLine]", 
                RowBox[{
                 RowBox[{"list", "=", 
                  RowBox[{"Sort", "[", 
                   RowBox[{"List", "[", 
                    RowBox[{"k1", ",", "k2", ",", 
                    RowBox[{"b1", "[", 
                    RowBox[{"[", "p", "]"}], "]"}], ",", 
                    RowBox[{"b1", "[", 
                    RowBox[{"[", "p", "]"}], "]"}]}], "]"}], "]"}]}], ";", 
                 "\[IndentingNewLine]", "\[IndentingNewLine]", 
                 RowBox[{"If", "[", 
                  RowBox[{
                   RowBox[{
                    RowBox[{
                    RowBox[{
                    RowBox[{
                    RowBox[{"Ints", "[", 
                    RowBox[{"[", " ", 
                    RowBox[{
                    RowBox[{"list", "[", 
                    RowBox[{"[", "1", "]"}], "]"}], "+", "1"}], " ", "]"}], 
                    "]"}], "[", 
                    RowBox[{"[", " ", 
                    RowBox[{
                    RowBox[{"list", "[", 
                    RowBox[{"[", "2", "]"}], "]"}], "+", "1"}], " ", "]"}], 
                    "]"}], " ", "[", 
                    RowBox[{"[", " ", 
                    RowBox[{
                    RowBox[{"list", "[", 
                    RowBox[{"[", "3", "]"}], "]"}], "+", "1"}], " ", "]"}], 
                    "]"}], "[", 
                    RowBox[{"[", " ", 
                    RowBox[{
                    RowBox[{"list", "[", 
                    RowBox[{"[", "4", "]"}], "]"}], "+", "1"}], " ", "]"}], 
                    "]"}], "\[Equal]", "0"}], ",", "\[IndentingNewLine]", 
                   RowBox[{
                    RowBox[{
                    RowBox[{
                    RowBox[{
                    RowBox[{
                    RowBox[{"Ints", "[", 
                    RowBox[{"[", " ", 
                    RowBox[{
                    RowBox[{"list", "[", 
                    RowBox[{"[", "1", "]"}], "]"}], "+", "1"}], " ", "]"}], 
                    "]"}], "[", 
                    RowBox[{"[", " ", 
                    RowBox[{
                    RowBox[{"list", "[", 
                    RowBox[{"[", "2", "]"}], "]"}], "+", "1"}], " ", "]"}], 
                    "]"}], " ", "[", 
                    RowBox[{"[", " ", 
                    RowBox[{
                    RowBox[{"list", "[", 
                    RowBox[{"[", "3", "]"}], "]"}], "+", "1"}], " ", "]"}], 
                    "]"}], "[", 
                    RowBox[{"[", " ", 
                    RowBox[{
                    RowBox[{"list", "[", 
                    RowBox[{"[", "4", "]"}], "]"}], "+", "1"}], " ", "]"}], 
                    "]"}], "=", 
                    RowBox[{"Int", "[", " ", 
                    RowBox[{
                    RowBox[{"list", "[", 
                    RowBox[{"[", "1", "]"}], "]"}], ",", " ", 
                    RowBox[{"list", "[", 
                    RowBox[{"[", "2", "]"}], "]"}], ",", " ", 
                    RowBox[{"list", "[", 
                    RowBox[{"[", "3", "]"}], "]"}], ",", " ", 
                    RowBox[{"list", "[", 
                    RowBox[{"[", "4", "]"}], "]"}]}], " ", "]"}]}], ";"}]}], 
                  "]"}], ";", "\[IndentingNewLine]", "\[IndentingNewLine]", 
                 RowBox[{"mElement", "+=", 
                  RowBox[{
                   RowBox[{
                    RowBox[{
                    RowBox[{"Ints", "[", 
                    RowBox[{"[", " ", 
                    RowBox[{
                    RowBox[{"list", "[", 
                    RowBox[{"[", "1", "]"}], "]"}], "+", "1"}], " ", "]"}], 
                    "]"}], "[", 
                    RowBox[{"[", " ", 
                    RowBox[{
                    RowBox[{"list", "[", 
                    RowBox[{"[", "2", "]"}], "]"}], "+", "1"}], " ", "]"}], 
                    "]"}], " ", "[", 
                    RowBox[{"[", " ", 
                    RowBox[{
                    RowBox[{"list", "[", 
                    RowBox[{"[", "3", "]"}], "]"}], "+", "1"}], " ", "]"}], 
                    "]"}], "[", 
                   RowBox[{"[", " ", 
                    RowBox[{
                    RowBox[{"list", "[", 
                    RowBox[{"[", "4", "]"}], "]"}], "+", "1"}], " ", "]"}], 
                   "]"}]}], ";"}]}], "]"}], ";", "\[IndentingNewLine]", 
              "\[IndentingNewLine]", 
              RowBox[{"mElement", "*=", 
               RowBox[{
                RowBox[{"(", 
                 RowBox[{"-", "1"}], ")"}], "^", 
                RowBox[{"(", 
                 RowBox[{"k1pos", "+", "k2pos"}], ")"}]}]}], ";", 
              "\[IndentingNewLine]", "\[IndentingNewLine]", 
              RowBox[{"str", " ", "=", " ", 
               RowBox[{
                RowBox[{"ToString", "[", "i", "]"}], "<>", " ", "\"\< \>\"", "<>", 
                RowBox[{"ToString", "[", "j", "]"}], " ", "<>", " ", 
                "\"\< \>\"", "<>", 
                RowBox[{"ToString", "[", 
                 RowBox[{"NumberForm", "[", 
                  RowBox[{"mElement", ",", "Infinity", ",", 
                   RowBox[{"ExponentFunction", "\[Rule]", 
                    RowBox[{"(", 
                    RowBox[{"Null", "&"}], ")"}]}]}], "]"}], "]"}], "<>", 
                " ", "\"\<\\n\>\""}]}], ";", "\[IndentingNewLine]", 
              RowBox[{"WriteString", "[", 
               RowBox[{"output", ",", "str"}], "]"}], ";", 
              "\[IndentingNewLine]", 
              RowBox[{"mElementCount", "++"}], ";", "\[IndentingNewLine]", 
              "\[IndentingNewLine]", 
              RowBox[{"Continue", "[", "]"}], ";"}]}], "]"}], ";", 
           "\[IndentingNewLine]", "\[IndentingNewLine]", 
           RowBox[{"If", "[", 
            RowBox[{
             RowBox[{
              RowBox[{
               RowBox[{"Length", "[", "SDa", "]"}], "\[Equal]", "0"}], "&&", 
              RowBox[{
               RowBox[{"Length", "[", "SDb", "]"}], "\[Equal]", "2"}]}], ",", 
             "\[IndentingNewLine]", 
             RowBox[{
              RowBox[{"k3", "=", 
               RowBox[{
                RowBox[{"Complement", "[", 
                 RowBox[{"b1", ",", "b2"}], "]"}], "[", 
                RowBox[{"[", "1", "]"}], "]"}]}], ";", "\[IndentingNewLine]", 
              
              RowBox[{"k4", "=", 
               RowBox[{
                RowBox[{"Complement", "[", 
                 RowBox[{"b2", ",", "b1"}], "]"}], "[", 
                RowBox[{"[", "1", "]"}], "]"}]}], ";", "\[IndentingNewLine]", 
              "\[IndentingNewLine]", 
              RowBox[{"If", "[", 
               RowBox[{
                RowBox[{
                 RowBox[{"Mod", "[", 
                  RowBox[{
                   RowBox[{"k3", "+", "k4"}], ",", "2"}], "]"}], "\[Equal]", 
                 "1"}], ",", 
                RowBox[{"Continue", "[", "]"}]}], "]"}], ";", 
              "\[IndentingNewLine]", "\[IndentingNewLine]", 
              RowBox[{"k3pos", "=", 
               RowBox[{
                RowBox[{"Position", "[", 
                 RowBox[{"b1", ",", 
                  RowBox[{
                   RowBox[{"Complement", "[", 
                    RowBox[{"b1", ",", "b2"}], "]"}], "[", 
                   RowBox[{"[", "1", "]"}], "]"}]}], "]"}], "[", 
                RowBox[{"[", 
                 RowBox[{"1", ",", "1"}], "]"}], "]"}]}], ";", 
              "\[IndentingNewLine]", 
              RowBox[{"k4pos", "=", 
               RowBox[{
                RowBox[{"Position", "[", 
                 RowBox[{"b2", ",", 
                  RowBox[{
                   RowBox[{"Complement", "[", 
                    RowBox[{"b2", ",", "b1"}], "]"}], "[", 
                   RowBox[{"[", "1", "]"}], "]"}]}], "]"}], "[", 
                RowBox[{"[", 
                 RowBox[{"1", ",", "1"}], "]"}], "]"}]}], ";", 
              "\[IndentingNewLine]", "\[IndentingNewLine]", 
              RowBox[{"mElement", "=", "0"}], ";", "\[IndentingNewLine]", 
              RowBox[{"For", "[", 
               RowBox[{
                RowBox[{"p", "=", "1"}], ",", 
                RowBox[{"p", "\[LessEqual]", "nA"}], ",", 
                RowBox[{"p", "++"}], ",", "\[IndentingNewLine]", 
                RowBox[{
                 RowBox[{"list", "=", 
                  RowBox[{"Sort", "[", 
                   RowBox[{"List", "[", 
                    RowBox[{
                    RowBox[{"a1", "[", 
                    RowBox[{"[", "p", "]"}], "]"}], ",", 
                    RowBox[{"a1", "[", 
                    RowBox[{"[", "p", "]"}], "]"}], ",", "k3", ",", "k4"}], 
                    "]"}], "]"}]}], ";", "\[IndentingNewLine]", 
                 "\[IndentingNewLine]", 
                 RowBox[{"If", "[", 
                  RowBox[{
                   RowBox[{
                    RowBox[{
                    RowBox[{
                    RowBox[{
                    RowBox[{"Ints", "[", 
                    RowBox[{"[", " ", 
                    RowBox[{
                    RowBox[{"list", "[", 
                    RowBox[{"[", "1", "]"}], "]"}], "+", "1"}], " ", "]"}], 
                    "]"}], "[", 
                    RowBox[{"[", " ", 
                    RowBox[{
                    RowBox[{"list", "[", 
                    RowBox[{"[", "2", "]"}], "]"}], "+", "1"}], " ", "]"}], 
                    "]"}], " ", "[", 
                    RowBox[{"[", " ", 
                    RowBox[{
                    RowBox[{"list", "[", 
                    RowBox[{"[", "3", "]"}], "]"}], "+", "1"}], " ", "]"}], 
                    "]"}], "[", 
                    RowBox[{"[", " ", 
                    RowBox[{
                    RowBox[{"list", "[", 
                    RowBox[{"[", "4", "]"}], "]"}], "+", "1"}], " ", "]"}], 
                    "]"}], "\[Equal]", "0"}], ",", "\[IndentingNewLine]", 
                   RowBox[{
                    RowBox[{
                    RowBox[{
                    RowBox[{
                    RowBox[{
                    RowBox[{"Ints", "[", 
                    RowBox[{"[", " ", 
                    RowBox[{
                    RowBox[{"list", "[", 
                    RowBox[{"[", "1", "]"}], "]"}], "+", "1"}], " ", "]"}], 
                    "]"}], "[", 
                    RowBox[{"[", " ", 
                    RowBox[{
                    RowBox[{"list", "[", 
                    RowBox[{"[", "2", "]"}], "]"}], "+", "1"}], " ", "]"}], 
                    "]"}], " ", "[", 
                    RowBox[{"[", " ", 
                    RowBox[{
                    RowBox[{"list", "[", 
                    RowBox[{"[", "3", "]"}], "]"}], "+", "1"}], " ", "]"}], 
                    "]"}], "[", 
                    RowBox[{"[", " ", 
                    RowBox[{
                    RowBox[{"list", "[", 
                    RowBox[{"[", "4", "]"}], "]"}], "+", "1"}], " ", "]"}], 
                    "]"}], "=", 
                    RowBox[{"Int", "[", " ", 
                    RowBox[{
                    RowBox[{"list", "[", 
                    RowBox[{"[", "1", "]"}], "]"}], ",", " ", 
                    RowBox[{"list", "[", 
                    RowBox[{"[", "2", "]"}], "]"}], ",", " ", 
                    RowBox[{"list", "[", 
                    RowBox[{"[", "3", "]"}], "]"}], ",", " ", 
                    RowBox[{"list", "[", 
                    RowBox[{"[", "4", "]"}], "]"}]}], " ", "]"}]}], ";"}]}], 
                  "]"}], ";", "\[IndentingNewLine]", "\[IndentingNewLine]", 
                 RowBox[{"mElement", "+=", 
                  RowBox[{
                   RowBox[{
                    RowBox[{
                    RowBox[{"Ints", "[", 
                    RowBox[{"[", " ", 
                    RowBox[{
                    RowBox[{"list", "[", 
                    RowBox[{"[", "1", "]"}], "]"}], "+", "1"}], " ", "]"}], 
                    "]"}], "[", 
                    RowBox[{"[", " ", 
                    RowBox[{
                    RowBox[{"list", "[", 
                    RowBox[{"[", "2", "]"}], "]"}], "+", "1"}], " ", "]"}], 
                    "]"}], " ", "[", 
                    RowBox[{"[", " ", 
                    RowBox[{
                    RowBox[{"list", "[", 
                    RowBox[{"[", "3", "]"}], "]"}], "+", "1"}], " ", "]"}], 
                    "]"}], "[", 
                   RowBox[{"[", " ", 
                    RowBox[{
                    RowBox[{"list", "[", 
                    RowBox[{"[", "4", "]"}], "]"}], "+", "1"}], " ", "]"}], 
                   "]"}]}], ";"}]}], "]"}], ";", "\[IndentingNewLine]", 
              "\[IndentingNewLine]", 
              RowBox[{"mElement", "*=", 
               RowBox[{
                RowBox[{"(", 
                 RowBox[{"-", "1"}], ")"}], "^", 
                RowBox[{"(", 
                 RowBox[{"k3pos", "+", "k4pos"}], ")"}]}]}], ";", 
              "\[IndentingNewLine]", "\[IndentingNewLine]", 
              RowBox[{"str", " ", "=", " ", 
               RowBox[{
                RowBox[{"ToString", "[", "i", "]"}], "<>", " ", "\"\< \>\"", "<>", 
                RowBox[{"ToString", "[", "j", "]"}], " ", "<>", " ", 
                "\"\< \>\"", "<>", 
                RowBox[{"ToString", "[", 
                 RowBox[{"NumberForm", "[", 
                  RowBox[{"mElement", ",", "Infinity", ",", 
                   RowBox[{"ExponentFunction", "\[Rule]", 
                    RowBox[{"(", 
                    RowBox[{"Null", "&"}], ")"}]}]}], "]"}], "]"}], "<>", 
                " ", "\"\<\\n\>\""}]}], ";", "\[IndentingNewLine]", 
              RowBox[{"WriteString", "[", 
               RowBox[{"output", ",", "str"}], "]"}], ";", 
              "\[IndentingNewLine]", 
              RowBox[{"mElementCount", "++"}], ";", "\[IndentingNewLine]", 
              "\[IndentingNewLine]", 
              RowBox[{"Continue", "[", "]"}], ";"}]}], "]"}], ";", 
           "\[IndentingNewLine]", "\[IndentingNewLine]", 
           RowBox[{"If", "[", 
            RowBox[{
             RowBox[{
              RowBox[{
               RowBox[{"Length", "[", "SDa", "]"}], "\[Equal]", "0"}], " ", "&&",
               " ", 
              RowBox[{
               RowBox[{"Length", "[", "SDb", "]"}], "\[Equal]", "0"}]}], ",", 
             "\[IndentingNewLine]", 
             RowBox[{
              RowBox[{"mElement", "=", "0"}], ";", "\[IndentingNewLine]", 
              RowBox[{"For", "[", 
               RowBox[{
                RowBox[{"p", "=", "1"}], ",", 
                RowBox[{"p", "\[LessEqual]", "nA"}], ",", 
                RowBox[{"p", "++"}], ",", "\[IndentingNewLine]", 
                RowBox[{"For", "[", 
                 RowBox[{
                  RowBox[{"q", "=", "1"}], ",", 
                  RowBox[{"q", "\[LessEqual]", "nB"}], ",", 
                  RowBox[{"q", "++"}], ",", "\[IndentingNewLine]", 
                  RowBox[{
                   RowBox[{"list", "=", 
                    RowBox[{"Sort", "[", 
                    RowBox[{"List", "[", 
                    RowBox[{
                    RowBox[{"a1", "[", 
                    RowBox[{"[", "p", "]"}], "]"}], ",", 
                    RowBox[{"a1", "[", 
                    RowBox[{"[", "p", "]"}], "]"}], ",", 
                    RowBox[{"b1", "[", 
                    RowBox[{"[", "q", "]"}], "]"}], ",", 
                    RowBox[{"b1", "[", 
                    RowBox[{"[", "q", "]"}], "]"}]}], "]"}], "]"}]}], ";", 
                   "\[IndentingNewLine]", "\[IndentingNewLine]", 
                   RowBox[{"If", "[", 
                    RowBox[{
                    RowBox[{
                    RowBox[{
                    RowBox[{
                    RowBox[{
                    RowBox[{"Ints", "[", 
                    RowBox[{"[", " ", 
                    RowBox[{
                    RowBox[{"list", "[", 
                    RowBox[{"[", "1", "]"}], "]"}], "+", "1"}], " ", "]"}], 
                    "]"}], "[", 
                    RowBox[{"[", " ", 
                    RowBox[{
                    RowBox[{"list", "[", 
                    RowBox[{"[", "2", "]"}], "]"}], "+", "1"}], " ", "]"}], 
                    "]"}], " ", "[", 
                    RowBox[{"[", " ", 
                    RowBox[{
                    RowBox[{"list", "[", 
                    RowBox[{"[", "3", "]"}], "]"}], "+", "1"}], " ", "]"}], 
                    "]"}], "[", 
                    RowBox[{"[", " ", 
                    RowBox[{
                    RowBox[{"list", "[", 
                    RowBox[{"[", "4", "]"}], "]"}], "+", "1"}], " ", "]"}], 
                    "]"}], "\[Equal]", "0"}], ",", "\[IndentingNewLine]", 
                    RowBox[{
                    RowBox[{
                    RowBox[{
                    RowBox[{
                    RowBox[{
                    RowBox[{"Ints", "[", 
                    RowBox[{"[", " ", 
                    RowBox[{
                    RowBox[{"list", "[", 
                    RowBox[{"[", "1", "]"}], "]"}], "+", "1"}], " ", "]"}], 
                    "]"}], "[", 
                    RowBox[{"[", " ", 
                    RowBox[{
                    RowBox[{"list", "[", 
                    RowBox[{"[", "2", "]"}], "]"}], "+", "1"}], " ", "]"}], 
                    "]"}], " ", "[", 
                    RowBox[{"[", " ", 
                    RowBox[{
                    RowBox[{"list", "[", 
                    RowBox[{"[", "3", "]"}], "]"}], "+", "1"}], " ", "]"}], 
                    "]"}], "[", 
                    RowBox[{"[", " ", 
                    RowBox[{
                    RowBox[{"list", "[", 
                    RowBox[{"[", "4", "]"}], "]"}], "+", "1"}], " ", "]"}], 
                    "]"}], "=", 
                    RowBox[{"Int", "[", " ", 
                    RowBox[{
                    RowBox[{"list", "[", 
                    RowBox[{"[", "1", "]"}], "]"}], ",", " ", 
                    RowBox[{"list", "[", 
                    RowBox[{"[", "2", "]"}], "]"}], ",", " ", 
                    RowBox[{"list", "[", 
                    RowBox[{"[", "3", "]"}], "]"}], ",", " ", 
                    RowBox[{"list", "[", 
                    RowBox[{"[", "4", "]"}], "]"}]}], " ", "]"}]}], ";"}]}], 
                    "]"}], ";", "\[IndentingNewLine]", "\[IndentingNewLine]", 
                   
                   RowBox[{"mElement", "+=", 
                    RowBox[{
                    RowBox[{
                    RowBox[{
                    RowBox[{"Ints", "[", 
                    RowBox[{"[", " ", 
                    RowBox[{
                    RowBox[{"list", "[", 
                    RowBox[{"[", "1", "]"}], "]"}], "+", "1"}], " ", "]"}], 
                    "]"}], "[", 
                    RowBox[{"[", " ", 
                    RowBox[{
                    RowBox[{"list", "[", 
                    RowBox[{"[", "2", "]"}], "]"}], "+", "1"}], " ", "]"}], 
                    "]"}], " ", "[", 
                    RowBox[{"[", " ", 
                    RowBox[{
                    RowBox[{"list", "[", 
                    RowBox[{"[", "3", "]"}], "]"}], "+", "1"}], " ", "]"}], 
                    "]"}], "[", 
                    RowBox[{"[", " ", 
                    RowBox[{
                    RowBox[{"list", "[", 
                    RowBox[{"[", "4", "]"}], "]"}], "+", "1"}], " ", "]"}], 
                    "]"}]}], ";"}]}], "]"}]}], "]"}], ";", 
              "\[IndentingNewLine]", "\[IndentingNewLine]", 
              RowBox[{"str", " ", "=", " ", 
               RowBox[{
                RowBox[{"ToString", "[", "i", "]"}], "<>", " ", "\"\< \>\"", "<>", 
                RowBox[{"ToString", "[", "j", "]"}], " ", "<>", " ", 
                "\"\< \>\"", "<>", 
                RowBox[{"ToString", "[", 
                 RowBox[{"NumberForm", "[", 
                  RowBox[{"mElement", ",", "Infinity", ",", 
                   RowBox[{"ExponentFunction", "\[Rule]", 
                    RowBox[{"(", 
                    RowBox[{"Null", "&"}], ")"}]}]}], "]"}], "]"}], "<>", 
                " ", "\"\<\\n\>\""}]}], ";", "\[IndentingNewLine]", 
              RowBox[{"WriteString", "[", 
               RowBox[{"output", ",", "str"}], "]"}], ";", 
              "\[IndentingNewLine]", 
              RowBox[{"mElementCount", "++"}], ";", "\[IndentingNewLine]", 
              "\[IndentingNewLine]", 
              RowBox[{"Continue", "[", "]"}], ";"}]}], "]"}], ";"}]}], 
         "\[IndentingNewLine]", "\[IndentingNewLine]", "]"}]}], "]"}], ";", 
      "\[IndentingNewLine]", 
      RowBox[{"strRange", "=", 
       RowBox[{
        RowBox[{"ToString", "[", "mElementCount", "]"}], "<>", 
        "\"\<\\n\>\""}]}], ";", "\[IndentingNewLine]", 
      RowBox[{"WriteString", "[", 
       RowBox[{"outputRanges", ",", "strRange"}], "]"}], ";"}]}], "]"}], 
   ";"}], "\[IndentingNewLine]"}], "\[IndentingNewLine]", 
 RowBox[{
  RowBox[{"Close", "[", "output", "]"}], ";"}], "\[IndentingNewLine]", 
 RowBox[{
  RowBox[{"Close", "[", "outputRanges", "]"}], ";"}]}], "Input",
 CellChangeTimes->CompressedData["
1:eJxTTMoPSmViYGCQAGIQrRTHlWtt8cZRhiu/AEQbz7zSBKKFizSbQfSxQ397
QPS0fXL9IPqF8qoVYPUF68G0kO71bDsg3Wa4PwdEWx06WwSiOebuKwbRs089
rgDRNbuTe8B8y10TQfS+BeEzQfScSyVzQfS5j6HLQPQ8kxc7QfSJB6sPgmiz
Y6eOgejd216dANHtKr/PgeV531wC0Ve6Sm6B6AwjoYcgmm1ewGsQ/SFzMZh+
8CHvPYg2WVMoaQ+k32wtlAXRRff1NUB0HZ+gHojm/CttCqITMmzcQXTrgXsR
IFpgqmQ+iH5iMbsCRIf69l9xAtsvdxVEq5nLpqUCaZ0kznQQXfdxRgWIzi26
BaYfrkg2yQHSTRoediDa2WKNN4g+GXYrCEQDANaEspk=
  
  "],ExpressionUUID->"e7f72775-dacb-45e4-a25b-1e65637902a5"]
},
WindowSize->{1366, 715},
WindowMargins->{{0, Automatic}, {0, Automatic}},
FrontEndVersion->"11.3 for Linux x86 (64-bit) (March 6, 2018)",
StyleDefinitions->"Default.nb"
]
(* End of Notebook Content *)

(* Internal cache information *)
(*CellTagsOutline
CellTagsIndex->{}
*)
(*CellTagsIndex
CellTagsIndex->{}
*)
(*NotebookFileOutline
Notebook[{
Cell[558, 20, 307, 5, 78, "Input",ExpressionUUID->"d9d3ee98-09f5-400c-b165-482fd4ca14fc"],
Cell[868, 27, 428, 9, 31, "Input",ExpressionUUID->"6146baa7-61d9-49d3-a1d3-1372aa59537b"],
Cell[1299, 38, 701, 15, 101, "Input",ExpressionUUID->"885eaba1-f8e9-4062-b490-18e6f5ebbe3b"],
Cell[2003, 55, 1548, 43, 193, "Input",ExpressionUUID->"785c69a0-1d95-452d-b968-dd6c4839635b"],
Cell[CellGroupData[{
Cell[3576, 102, 2329, 65, 147, "Input",ExpressionUUID->"7da341fc-666e-4921-b72c-34e37e1a94e7"],
Cell[5908, 169, 601, 12, 22, "Message",ExpressionUUID->"9de52472-d32b-46b9-893a-5b6baf0e74d4"]
}, Open  ]],
Cell[6524, 184, 33159, 749, 2631, "Input",ExpressionUUID->"e7f72775-dacb-45e4-a25b-1e65637902a5"]
}
]
*)

